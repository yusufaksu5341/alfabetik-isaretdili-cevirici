<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TÄ°D Ã‡evirici â€” TÃ¼rk Ä°ÅŸaret Dili Harf TanÄ±ma</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header class="hdr">
  <div class="hdr-brand">
    <div class="hdr-ico">ğŸ¤Ÿ</div>
    <div>
      <div class="hdr-t">TÄ°D Ã‡evirici</div>
      <div class="hdr-s">TÃ¼rk Ä°ÅŸaret Dili â€” Roboflow AI</div>
    </div>
  </div>
  <div class="pill loading" id="pill">
    <span class="pdot"></span>
    <span id="pillTxt">Kamera baÅŸlatÄ±lÄ±yorâ€¦</span>
  </div>
</header>

<main class="layout">

  <div class="alert">
    ğŸ¤–&nbsp;
    <span>
      <b>Roboflow AI Modeli:</b> <code style="background:rgba(2,132,199,.1);padding:1px 6px;border-radius:4px;font-size:12px">harfler-ve-kelimeler/1</code>
      modeli kullanÄ±lÄ±yor. Harfi <b>1.5 saniye sabit tutun</b> â€” otomatik onaylanÄ±r.
      En iyi sonuÃ§ iÃ§in elinizi kameradan <b>30â€“60 cm</b> uzakta tutun.
    </span>
  </div>

  <!-- CAMERA -->
  <div class="cam-col">
    <div class="card cam-card">
      <div class="ch">
        <span class="cl">Kamera</span>
        <div style="display:flex;gap:8px;align-items:center">
          <span id="fpsBadge" style="font-size:11px;color:var(--g400);font-family:'JetBrains Mono',monospace"></span>
          <button class="btn bs" id="pauseBtn" onclick="togglePause()" style="padding:4px 11px;font-size:11.5px">â¸ Durdur</button>
        </div>
      </div>
      <div class="cam-wrap" id="camWrap">
        <video id="video" autoplay muted playsinline></video>
        <canvas id="canvas"></canvas>
        <canvas id="bboxCanvas" style="position:absolute;inset:0;width:100%;height:100%;transform:scaleX(-1);z-index:7;pointer-events:none"></canvas>
        <div class="corners">
          <div class="cr tl"></div><div class="cr tr"></div>
          <div class="cr bl"></div><div class="cr br"></div>
        </div>
        <div class="cam-badge">
          <span class="cbl" id="camLetter">â€”</span>
          <span class="cbs">TÄ°D</span>
        </div>
        <div class="hold-ring" id="holdRing">
          <svg width="42" height="42" viewBox="0 0 42 42">
            <circle cx="21" cy="21" r="17.5" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="2.5"/>
            <circle cx="21" cy="21" r="17.5" fill="none" stroke-width="2.5" id="holdArc"/>
          </svg>
        </div>
        <div class="cam-conf">
          <div class="ccr">
            <span class="ccl">GÃœVEN</span>
            <span class="ccv" id="ccv">â€”</span>
          </div>
          <div class="cct"><div class="ccf" id="ccf"></div></div>
        </div>
        <div class="cam-load" id="camLoad">
          <div class="spin"></div>
          <div class="clt" id="clt">Kamera baÅŸlatÄ±lÄ±yorâ€¦</div>
        </div>
      </div>
    </div>

    <!-- Alphabet â€” NO descriptions -->
    <div class="card">
      <div class="ch">
        <span class="cl">TÄ°D Parmak Alfabesi</span>
        <span id="scnt" style="font-size:11px;color:var(--g400);font-family:'JetBrains Mono',monospace"></span>
      </div>
      <div class="cb" style="padding:14px">
        <div class="agrid" id="agrid"></div>
      </div>
    </div>

    <!-- How to use -->
    <div class="card">
      <div class="ch"><span class="cl">KullanÄ±m</span></div>
      <div class="cb">
        <ol class="how">
          <li class="hwi"><span class="hws">1</span><span>Elinizi kameraya gÃ¶sterin â€” AI otomatik algÄ±lar.</span></li>
          <li class="hwi"><span class="hws">2</span><span>Harfi <b>1.5 saniye sabit tutun</b> â€” halka dolunca onaylanÄ±r.</span></li>
          <li class="hwi"><span class="hws">3</span><span>Harfleri biriktirip <b>Kelime Ekle</b> ile kaydedin.</span></li>
          <li class="hwi"><span class="hws">4</span><span><b>CÃ¼mle OluÅŸtur</b> â€” Claude AI kelimelerinizden cÃ¼mle kurar.</span></li>
          <li class="hwi"><span class="hws">âŒ¨</span><span>BoÅŸluk = kelime &nbsp;|&nbsp; Backspace = sil &nbsp;|&nbsp; Enter = cÃ¼mle</span></li>
        </ol>
      </div>
    </div>
  </div>

  <!-- RIGHT COL -->
  <div class="rcol">

    <div class="card lp">
      <div class="ch"><span class="cl">AlgÄ±lanan Harf</span></div>
      <div class="cb">
        <div class="lbw" id="lbig">â€”</div>
        <div class="lm">
          <div class="ln" id="lname">El bekleniyorâ€¦</div>
          <div class="cr-row">
            <div class="ct"><div class="cb2" id="cb2"></div></div>
            <span class="cp" id="cpct">â€”</span>
          </div>
          <div class="hcd" id="hcd">Harfi <span>1.5 sn</span> sabit tutun</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="ch">
        <span class="cl">Kelime OluÅŸturucu</span>
        <span id="chcnt" style="font-size:11px;color:var(--g400);font-family:'JetBrains Mono',monospace">0 harf</span>
      </div>
      <div class="cb">
        <div class="wa" id="wa"><span class="wph">Harfler burada gÃ¶rÃ¼nÃ¼râ€¦</span></div>
        <div class="brow">
          <button class="btn bd" onclick="delChar()">âŒ« Sil</button>
          <button class="btn bp" onclick="addWord()">Kelime Ekle â†’</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="ch">
        <span class="cl">Kelimeler</span>
        <span id="wcnt" style="font-size:11px;color:var(--g400);font-family:'JetBrains Mono',monospace">0</span>
      </div>
      <div class="cb">
        <div class="wlist" id="wlist"><span class="wem">Kelimeler burada gÃ¶rÃ¼nÃ¼râ€¦</span></div>
        <div class="brow">
          <button class="btn bd" onclick="clearAll()">ğŸ—‘ Temizle</button>
          <button class="btn bg" onclick="makeSentence()">âœ¨ CÃ¼mle OluÅŸtur</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="ch"><span class="cl">Claude AI CÃ¼mle</span></div>
      <div class="cb">
        <div class="sbox" id="sbox">
          <span class="sph">Kelimelerinizden anlamlÄ± bir TÃ¼rkÃ§e cÃ¼mle oluÅŸturmak iÃ§in "CÃ¼mle OluÅŸtur" butonunu kullanÄ±n.</span>
        </div>
        <div class="brow">
          <button class="btn bs" onclick="copySent()">ğŸ“‹ Kopyala</button>
          <button class="btn bs" onclick="speakSent()">ğŸ”Š Sesli Oku</button>
        </div>
      </div>
    </div>

  </div>
</main>
<div class="toasts" id="toasts"></div>

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const RF_API_KEY  = 'p6t4i9gco8ZGaA3Y1i26';
const RF_MODEL    = 'harfler-ve-kelimeler/1';
const RF_URL      = `https://serverless.roboflow.com/${RF_MODEL}?api_key=${RF_API_KEY}`;
const HOLD_MS     = 1500;
const INFER_MS    = 200;   // Roboflow'a istek atma aralÄ±ÄŸÄ± (ms)
const CONF_THRESH = 0.45;  // minimum gÃ¼ven skoru

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TÄ°D ALPHABET â€” tÃ¼m TÃ¼rkÃ§e harfler
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TID_LETTERS = ['A','B','C','Ã‡','D','E','F','G','Ä','H','I','Ä°','J','K','L','M','N','O','Ã–','P','R','S','Å','T','U','Ãœ','V','Y','Z'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let word = '', words = [];
let lastGest = null, holdT = null, locked = false, paused = false;
let lastInferTime = 0, inferPending = false;
let fpsCounter = 0, fpsLast = Date.now(), currentFps = 0;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BUILD ALPHABET GRID
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildAlpha() {
  const grid = document.getElementById('agrid');
  // Harfler modelin tanÄ±yabildiÄŸi â€” model Ã§Ä±ktÄ±sÄ±ndan gelen etiketler
  const modelLetters = new Set(TID_LETTERS);
  document.getElementById('scnt').textContent = TID_LETTERS.length + ' harf';
  TID_LETTERS.forEach(l => {
    const t = document.createElement('div');
    t.className = 'at on';
    t.id = 'tile-' + l;
    t.innerHTML = `<span class="atl">${l}</span><span class="adot"></span>`;
    grid.appendChild(t);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CAMERA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function startCam() {
  const v = document.getElementById('video');
  const s = await navigator.mediaDevices.getUserMedia({
    video: { width:{ideal:640}, height:{ideal:480}, facingMode:'user' },
    audio: false
  });
  v.srcObject = s;
  return new Promise(r => { v.onloadedmetadata = () => { v.play(); r(); }; });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function init() {
  buildAlpha();
  try {
    await startCam();
    document.getElementById('camLoad').style.display = 'none';
    setStatus('ready', 'HazÄ±r â€” el gÃ¶sterin');
    toast('Kamera hazÄ±r!', 'success');
    loop();
  } catch(e) {
    setStatus('error', 'Kamera hatasÄ±');
    document.getElementById('clt').textContent = 'Kamera eriÅŸimi reddedildi: ' + e.message;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MAIN LOOP â€” video frame â†’ Roboflow
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loop() {
  if (!paused) {
    const now = Date.now();
    // FPS counter
    fpsCounter++;
    if (now - fpsLast >= 1000) {
      currentFps = fpsCounter;
      fpsCounter = 0;
      fpsLast = now;
      document.getElementById('fpsBadge').textContent = currentFps + ' FPS';
    }
    // Roboflow inference throttled
    if (now - lastInferTime >= INFER_MS && !inferPending) {
      lastInferTime = now;
      inferFrame();
    }
  }
  requestAnimationFrame(loop);
}

async function inferFrame() {
  inferPending = true;
  const video  = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  canvas.width  = video.videoWidth  || 640;
  canvas.height = video.videoHeight || 480;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0);

  // Base64 JPEG (shrink to 416x416 for speed)
  const small = document.createElement('canvas');
  small.width = small.height = 416;
  small.getContext('2d').drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, 416, 416);
  const b64 = small.toDataURL('image/jpeg', 0.82).split(',')[1];

  try {
    const res  = await fetch(RF_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: b64
    });
    const data = await res.json();
    handlePredictions(data, canvas.width, canvas.height);
  } catch(e) {
    setStatus('error', 'API hatasÄ±');
  }
  inferPending = false;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HANDLE ROBOFLOW RESPONSE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handlePredictions(data, vw, vh) {
  const bboxCtx = document.getElementById('bboxCanvas');
  bboxCtx.width  = vw;
  bboxCtx.height = vh;
  const ctx = bboxCtx.getContext('2d');
  ctx.clearRect(0, 0, vw, vh);

  const preds = data.predictions || [];
  if (!preds.length) {
    resetHold();
    updateUI('â€”', 0);
    setStatus('ready', 'El gÃ¶sterin');
    highlightTile(null);
    return;
  }

  // Best prediction above threshold
  const best = preds
    .filter(p => p.confidence >= CONF_THRESH)
    .sort((a, b) => b.confidence - a.confidence)[0];

  if (!best) {
    resetHold();
    updateUI('â€”', 0);
    setStatus('ready', 'GÃ¼ven dÃ¼ÅŸÃ¼k â€” el gÃ¶sterin');
    return;
  }

  const letter = (best.class || '').toUpperCase();
  const conf   = best.confidence;

  // Draw bounding box on bbox canvas
  drawBBox(ctx, best, vw, vh, letter, conf);

  // Update UI
  updateUI(letter, conf);
  highlightTile(letter);
  setStatus('ready', `"${letter}" algÄ±landÄ± â€” %${Math.round(conf*100)}`);

  // Hold timer logic
  if (letter !== lastGest) {
    lastGest = letter; holdT = Date.now(); locked = false; setRing(0); return;
  }
  if (!locked) {
    const prog = Math.min((Date.now() - holdT) / HOLD_MS, 1);
    setRing(prog);
    if (prog >= 1) confirmLetter(letter);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DRAW BOUNDING BOX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawBBox(ctx, pred, vw, vh, letter, conf) {
  // Roboflow returns center x,y + width,height (normalized 0-1 OR pixel)
  // Check if values are 0-1 range or pixel range
  let x, y, w, h;
  if (pred.x <= 1 && pred.y <= 1) {
    // normalized
    x = pred.x * vw; y = pred.y * vh;
    w = pred.width * vw; h = pred.height * vh;
  } else {
    // pixel â€” but from 416x416 inference, scale back
    const sx = vw / 416, sy = vh / 416;
    x = pred.x * sx; y = pred.y * sy;
    w = pred.width * sx; h = pred.height * sy;
  }

  const x0 = x - w/2, y0 = y - h/2;
  const alpha = 0.5 + conf * 0.5;

  ctx.save();
  ctx.strokeStyle = `rgba(56,189,248,${alpha})`;
  ctx.lineWidth   = 2;
  ctx.shadowColor = 'rgba(56,189,248,.6)';
  ctx.shadowBlur  = 6;
  ctx.strokeRect(x0, y0, w, h);

  // Label pill
  ctx.shadowBlur = 0;
  const label = `${letter}  ${Math.round(conf*100)}%`;
  ctx.font = 'bold 13px JetBrains Mono, monospace';
  const tw = ctx.measureText(label).width;
  const px = 8, py = 5;

  ctx.fillStyle = 'rgba(8,15,31,.88)';
  ctx.beginPath();
  ctx.roundRect(x0, y0 - 28, tw + px*2, 22, 5);
  ctx.fill();

  ctx.fillStyle = 'rgba(56,189,248,.95)';
  ctx.fillText(label, x0 + px, y0 - 11);
  ctx.restore();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIRM LETTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function confirmLetter(letter) {
  locked = true;
  word += letter;
  setRing(0);
  const el = document.getElementById('camLetter');
  el.classList.remove('ok'); void el.offsetWidth; el.classList.add('ok');
  renderWord();
  toast(`"${letter}" onaylandÄ±`, 'info');
}

function resetHold() { lastGest = null; holdT = null; locked = false; setRing(0); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateUI(letter, conf) {
  const pct = Math.round(Math.min(Math.max(conf, 0), 1) * 100);
  document.getElementById('camLetter').textContent = letter;
  document.getElementById('lbig').textContent      = letter;
  document.getElementById('cb2').style.width       = pct + '%';
  document.getElementById('cpct').textContent      = letter !== 'â€”' ? pct + '%' : 'â€”';
  document.getElementById('ccf').style.width       = pct + '%';
  document.getElementById('ccv').textContent       = letter !== 'â€”' ? pct + '%' : 'â€”';
  document.getElementById('lname').textContent     = letter === 'â€”' ? 'El bekleniyorâ€¦' : `TÄ°D "${letter}" â€” %${pct} gÃ¼ven`;
}

function setRing(prog) {
  const circ = 110;
  document.getElementById('holdArc').setAttribute('stroke-dashoffset', circ - circ * prog);
  document.getElementById('holdRing').style.display = prog > 0 ? 'block' : 'none';
  document.getElementById('hcd').innerHTML = prog > 0
    ? `OnaylanÄ±yorâ€¦ <span>${((1 - prog) * HOLD_MS / 1000).toFixed(1)}s</span>`
    : `Harfi <span>1.5 sn</span> sabit tutun`;
}

let lastHighlight = null;
function highlightTile(letter) {
  if (lastHighlight) {
    const prev = document.getElementById('tile-' + lastHighlight);
    if (prev) prev.classList.remove('active');
  }
  if (letter) {
    const el = document.getElementById('tile-' + letter);
    if (el) el.classList.add('active');
    lastHighlight = letter;
  } else { lastHighlight = null; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WORD / SENTENCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderWord() {
  const a = document.getElementById('wa');
  a.innerHTML = '';
  if (!word) {
    const s = document.createElement('span'); s.className = 'wph'; s.textContent = 'Harfler burada gÃ¶rÃ¼nÃ¼râ€¦'; a.appendChild(s);
  } else {
    for (const c of word) { const s = document.createElement('span'); s.className = 'wc'; s.textContent = c; a.appendChild(s); }
  }
  const cur = document.createElement('span'); cur.className = 'wcur'; a.appendChild(cur);
  document.getElementById('chcnt').textContent = word.length + ' harf';
}

function renderWords() {
  const l = document.getElementById('wlist');
  l.innerHTML = '';
  document.getElementById('wcnt').textContent = words.length;
  if (!words.length) { const e = document.createElement('span'); e.className = 'wem'; e.textContent = 'Kelimeler burada gÃ¶rÃ¼nÃ¼râ€¦'; l.appendChild(e); return; }
  words.forEach((w, i) => {
    const c = document.createElement('div'); c.className = 'wchip'; c.textContent = w; c.title = 'TÄ±kla: sil';
    c.onclick = () => { words.splice(i, 1); renderWords(); };
    l.appendChild(c);
  });
}

function delChar()  { word = word.slice(0, -1); renderWord(); }
function addWord()  {
  const t = word.trim();
  if (!t) { toast('Ã–nce harf oluÅŸturun', 'warn'); return; }
  words.push(t.toUpperCase()); word = ''; renderWord(); renderWords();
  toast(`"${t.toUpperCase()}" eklendi`, 'success');
}
function clearAll() {
  word = ''; words = []; renderWord(); renderWords();
  document.getElementById('sbox').innerHTML = '<span class="sph">Kelimelerinizden anlamlÄ± bir TÃ¼rkÃ§e cÃ¼mle oluÅŸturmak iÃ§in "CÃ¼mle OluÅŸtur" butonunu kullanÄ±n.</span>';
  toast('Temizlendi', 'info');
}

async function makeSentence() {
  const all = [...words, ...(word.trim() ? [word.toUpperCase()] : [])];
  if (!all.length) { toast('Kelime yok!', 'warn'); return; }
  const b = document.getElementById('sbox');
  b.className = 'sbox ld'; b.textContent = 'Claude AI cÃ¼mle oluÅŸturuyorâ€¦';
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514', max_tokens: 1000,
        system: 'TÃ¼rkÃ§e dil asistanÄ±sÄ±n. Verilen kelimelerden doÄŸal, dilbilgisi doÄŸru bir TÃ¼rkÃ§e cÃ¼mle oluÅŸtur. Sadece cÃ¼mleyi yaz.',
        messages: [{ role: 'user', content: `Bu kelimelerden TÃ¼rkÃ§e cÃ¼mle kur: ${all.join(', ')}` }]
      })
    });
    const data = await res.json();
    const txt  = data?.content?.[0]?.text;
    b.className = 'sbox';
    if (txt) { b.textContent = txt; toast('CÃ¼mle oluÅŸturuldu!', 'success'); }
    else     { b.innerHTML = '<span class="sph">CÃ¼mle alÄ±namadÄ±.</span>'; toast('Hata', 'warn'); }
  } catch(e) {
    b.className = 'sbox';
    b.innerHTML = `<span class="sph" style="color:#b91c1c">BaÄŸlantÄ± hatasÄ±: ${e.message}</span>`;
    toast('API hatasÄ±', 'warn');
  }
}

function copySent() {
  const t = document.getElementById('sbox').textContent;
  if (t.includes('oluÅŸturmak iÃ§in')) { toast('Ã–nce cÃ¼mle oluÅŸturun', 'warn'); return; }
  navigator.clipboard.writeText(t).then(() => toast('KopyalandÄ±', 'success')).catch(() => toast('Kopyalama baÅŸarÄ±sÄ±z', 'warn'));
}
function speakSent() {
  const t = document.getElementById('sbox').textContent;
  if (t.includes('oluÅŸturmak iÃ§in')) { toast('Ã–nce cÃ¼mle oluÅŸturun', 'warn'); return; }
  const u = new SpeechSynthesisUtterance(t); u.lang = 'tr-TR'; u.rate = .9;
  speechSynthesis.cancel(); speechSynthesis.speak(u); toast('Sesli okunuyorâ€¦', 'info');
}

function togglePause() {
  paused = !paused;
  document.getElementById('pauseBtn').textContent = paused ? 'â–¶ BaÅŸlat' : 'â¸ Durdur';
  toast(paused ? 'DuraklatÄ±ldÄ±' : 'Yeniden baÅŸlatÄ±ldÄ±', 'info');
  if (paused) { document.getElementById('bboxCanvas').getContext('2d').clearRect(0,0,9999,9999); }
}

function setStatus(s, t) {
  const p = document.getElementById('pill'); p.className = 'pill ' + s;
  document.getElementById('pillTxt').textContent = t;
}
function toast(m, type = '') {
  const c = document.getElementById('toasts'), el = document.createElement('div');
  el.className = 'toast ' + type; el.textContent = m; c.appendChild(el);
  requestAnimationFrame(() => requestAnimationFrame(() => el.classList.add('show')));
  setTimeout(() => { el.classList.remove('show'); setTimeout(() => el.remove(), 280); }, 2700);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KEYBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('keydown', e => {
  if (e.code === 'Space')     { e.preventDefault(); addWord(); }
  if (e.code === 'Backspace') { e.preventDefault(); delChar(); }
  if (e.code === 'Enter')     { e.preventDefault(); makeSentence(); }
  if (e.code === 'KeyP')      { e.preventDefault(); togglePause(); }
});

window.addEventListener('load', () => { renderWord(); renderWords(); init(); });
</script>
</body>
</html>
